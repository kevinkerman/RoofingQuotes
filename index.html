<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find the Best Roofer Near You</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W54XX2MDF4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-W54XX2MDF4');
    gtag('config', 'AW-11337578068');
  </script>

  <style>
    /* Reset body background – video will be our background */
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background: none;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    /* Video Background Styles */
    #bgVideo {
      position: fixed;
      top: 0;
      left: 0;
      min-width: 100%;
      min-height: 100%;
      width: 100%;
      height: 100%;
      z-index: -1;
      object-fit: cover;
      pointer-events: none;
      cursor: not-allowed;
    }
    /* Optional: add a dark gradient overlay on top of the video */
    .video-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7));
      z-index: 0;
      pointer-events: none;
    }
    /* Container and other content */
    .container {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 700px;
      text-align: center;
      margin: 20px auto;
      position: relative;
      z-index: 1;
    }
    h1 {
      color: #2c4c6c;
      margin-bottom: 20px;
      font-size: 2.5em;
    }
    .btn {
      padding: 15px 40px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1em;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: scale(1.05);
      background: #218838;
    }
    .slide {
      display: none;
      padding: 25px;
      position: relative;
    }
    .slide.active {
      display: block;
    }
    .form-group {
      margin: 25px 0;
    }
    .form-group label {
      display: block;
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #2c4c6c;
      font-weight: 600;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s;
    }
    .form-group input:focus, .form-group select:focus {
      border-color: #28a745;
      outline: none;
    }
    .next-btn {
      padding: 12px 30px;
      background: #2c4c6c;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      margin-top: 20px;
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    .next-btn:not(:disabled) {
      opacity: 1;
      background: #28a745;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #eee;
      border-radius: 4px;
      margin: 20px 0;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: #28a745;
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .trust-badges {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }
    .trust-badge {
      width: 80px;
      opacity: 0.8;
    }
    .testimonial {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 25px 0;
      text-align: left;
    }
    .error-message {
      color: #dc3545;
      font-size: 0.9em;
      margin-top: 5px;
      display: none;
    }
    input:invalid, select:invalid {
      border-color: #dc3545;
    }
    input:valid, select:valid {
      border-color: #28a745;
    }
    .autocomplete-container {
      position: relative;
    }
    .pac-container {
      z-index: 10000 !important;
    }
    /* Mobile-specific styles */
    @media only screen and (max-width: 900px) {
      .container {
        padding: 20px;
        width: 95%;
      }
      h1 {
        font-size: 2em;
      }
      p {
        font-size: 1em;
      }
      .btn {
        padding: 10px 20px;
        font-size: 1em;
      }
      .form-group label {
        font-size: 1em;
        margin-bottom: 10px;
      }
      .form-group input, .form-group select {
        font-size: 0.9em;
        padding: 10px;
      }
      .next-btn {
        padding: 10px 20px;
        font-size: 0.9em;
      }
      .trust-badge {
        width: 60px;
      }
      .testimonial {
        font-size: 0.9em;
        padding: 15px;
      }
    }
  </style>
</head>
<body>

  <!-- Video Background -->
  <video id="bgVideo" autoplay muted loop playsinline>
    <!-- Replace the src attribute below with the existing video source from your GHL website builder -->
    <source src="https://storage.googleapis.com/msgsndr/p5ZKXWEUephwwTsEQZgU/media/67ae81be6e5839fedc2aaa4d.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <!-- Optional dark overlay -->
  <div class="video-overlay"></div>

  <!-- Step 1: Value Proposition -->
  <div class="container" id="step1">
    <h1>Get Matched With Top-Rated Roofers in Your Area</h1>
    <p style="font-size: 1.1em; line-height: 1.6; color: #555;">
      We partner with certified roofing professionals to deliver quality service. Whether you need repairs, replacements, 
      or insurance claims assistance, we'll match you with the best local experts.<br>
      <span style="display: block; margin-top: 15px; color: #28a745; font-weight: bold;">✓ Free Quotes &nbsp; ✓ 100% Satisfaction Guarantee &nbsp; ✓ 24/7 Support</span>
    </p>
    
    <div class="trust-badges">
      <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Better_Business_Bureau.svg" class="trust-badge" alt="BBB Accredited">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/7b/GAF_logo.svg" class="trust-badge" alt="GAF Certified">
    </div>

    <button class="btn" onclick="showStep2()">Get Your Free Match Now</button>

    <div class="testimonial">
      <p>"They connected me with 3 qualified roofers within hours. Saved me $1,200 compared to other quotes!"</p>
      <p style="font-weight: bold;">— Sarah J., Phoenix AZ</p>
    </div>
  </div>

  <!-- Step 2: Questionnaire -->
  <div class="container" id="step2" style="display: none;">
    <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>

    <!-- Slide 1: ZIP Code with City/State Display -->
    <div class="slide active" id="slide1">
      <div class="form-group">
        <label>Where is your property located?</label>
        <input type="text" id="zipcode" placeholder="Enter ZIP Code" required>
        <div id="locationDisplay" style="margin-top:10px; font-size:1em; color: #2c4c6c;"></div>
      </div>
      <button class="next-btn" onclick="nextSlide()" disabled>Next →</button>
    </div>

    <!-- Slide 2: Damage Status -->
    <div class="slide" id="slide2">
      <div class="form-group">
        <label>Is this for damage repair or routine maintenance?</label>
        <select id="damage" required>
          <option value="" disabled selected>Select an option</option>
          <option value="storm">Storm/Hail Damage</option>
          <option value="leak">Leak Repair</option>
          <option value="age">Aged Roof Replacement</option>
          <option value="preventative">Preventative Maintenance</option>
        </select>
      </div>
      <button class="next-btn" onclick="nextSlide()" disabled>Next →</button>
    </div>

    <!-- Slide 3: Insurance -->
    <div class="slide" id="slide3">
      <div class="form-group">
        <label>Will this project involve insurance?</label>
        <select id="insurance" required>
          <option value="" disabled selected>Select an option</option>
          <option value="yes">Yes - I need help with claims</option>
          <option value="no">No - Paying out of pocket</option>
          <option value="unsure">Not Sure Yet</option>
        </select>
      </div>
      <button class="next-btn" onclick="nextSlide()" disabled>Next →</button>
    </div>

    <!-- Slide 4: Timeline -->
    <div class="slide" id="slide4">
      <div class="form-group">
        <label>When do you need service?</label>
        <select id="timeline" required>
          <option value="" disabled selected>Select timeline</option>
          <option value="emergency">Immediately (24-48 hrs)</option>
          <option value="1week">Within 1 Week</option>
          <option value="1month">Within 1 Month</option>
          <option value="flexible">Flexible Timeline</option>
        </select>
      </div>
      <button class="next-btn" onclick="nextSlide()" disabled>Next →</button>
    </div>

    <!-- Slide 5: Address (New Slide) -->
    <div class="slide" id="slide5">
      <div class="form-group">
        <label>Please enter your street address</label>
        <div class="autocomplete-container">
          <input type="text" id="address" placeholder="Street Address" required>
          <div class="error-message" id="address-error">Please enter a valid address</div>
        </div>
      </div>
      <button class="next-btn" onclick="nextSlide()" disabled>Next →</button>
    </div>

    <!-- Slide 6: Contact Info -->
    <div class="slide" id="slide6">
      <div class="form-group">
        <label>How should contractors reach you?</label>
        <input type="text" id="name" placeholder="Full Name" required>
        <div class="error-message" id="name-error">Please enter your full name</div>

        <input type="email" id="email" placeholder="Email Address" style="margin-top:15px;">
        <div class="error-message" id="email-error">Please enter a valid email address</div>

        <input type="tel" id="phone" placeholder="Phone Number (XXX-XXX-XXXX)" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" style="margin-top:15px;" required>
        <div class="error-message" id="phone-error">Please enter a valid phone number</div>
      </div>
      <p style="font-size:0.9em; margin-top:15px;">We promise we won't send you promotions or sell your information!</p>
      <div class="testimonial" style="margin-top:25px;">
        <p>"We value your privacy. By submitting, you agree to our <a href="#">terms</a> and consent to up to 4 roofing partners contacting you."</p>
      </div>
      <button class="next-btn" onclick="validateFinalForm()">Get My Free Quotes</button>
    </div>
  </div>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoiftHq-lSNXLP4fUrkFro7FjhIyddxVI&libraries=places"></script>
  <script>
    let currentSlide = 1;
    const totalSlides = 6;
    // Record start time for each slide (in milliseconds)
    let slideStartTime = Date.now();

    // Initialize Google Maps Autocomplete for the address field
    function initAutocomplete() {
      const autocomplete = new google.maps.places.Autocomplete(
        document.getElementById('address'),
        {types: ['address']}
      );
      
      autocomplete.addListener('place_changed', () => {
        const place = autocomplete.getPlace();
        if (!place.geometry) {
          document.getElementById('address-error').style.display = 'block';
        } else {
          document.getElementById('address-error').style.display = 'none';
        }
      });
    }

    // Geocode the entered ZIP Code to display city and state
    function geocodeZip() {
      const zip = document.getElementById('zipcode').value.trim();
      if (zip.length !== 5) {
        document.getElementById('locationDisplay').innerHTML = '';
        return;
      }
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address: zip + ', USA' }, function(results, status) {
        if (status === 'OK' && results[0]) {
          let city = '';
          let state = '';
          results[0].address_components.forEach(component => {
            if (component.types.indexOf("locality") !== -1) {
              city = component.long_name;
            }
            if (component.types.indexOf("administrative_area_level_1") !== -1) {
              state = component.short_name;
            }
          });
          if (city && state) {
            document.getElementById('locationDisplay').innerHTML = city + ', ' + state;
          } else {
            document.getElementById('locationDisplay').innerHTML = '';
          }
        } else {
          document.getElementById('locationDisplay').innerHTML = '';
        }
      });
    }

    function showStep2() {
      document.getElementById('step1').style.display = 'none';
      document.getElementById('step2').style.display = 'block';
      updateProgress();
    }

    function nextSlide() {
      // Calculate and track time spent on current slide
      const now = Date.now();
      const timeSpent = (now - slideStartTime) / 1000; // in seconds
      gtag('event', 'slide_time', {
        'event_category': 'Engagement',
        'event_label': 'Slide ' + currentSlide,
        'value': timeSpent
      });

      document.getElementById(`slide${currentSlide}`).classList.remove('active');
      currentSlide++;
      document.getElementById(`slide${currentSlide}`).classList.add('active');
      updateProgress();
      updateNextButton();
      // Reset timer for the new slide
      slideStartTime = Date.now();
    }

    function updateProgress() {
      const progress = (currentSlide / totalSlides) * 100;
      document.getElementById('progress').style.width = `${progress}%`;
    }

    function updateNextButton() {
      const inputs = document.querySelectorAll(`#slide${currentSlide} input, #slide${currentSlide} select`);
      const nextButton = document.querySelector(`#slide${currentSlide} .next-btn`);

      let allFilled = true;
      inputs.forEach(input => {
        if (input.required && !input.value) allFilled = false;
      });

      nextButton.disabled = !allFilled;
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(String(email).toLowerCase());
    }

    function validatePhone(phone) {
      const re = /^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/;
      return re.test(phone);
    }

    function validateFinalForm() {
      document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
      let isValid = true;

      // Validate name
      const name = document.getElementById('name');
      if (!name.value.trim()) {
        document.getElementById('name-error').style.display = 'block';
        isValid = false;
      }

      // Validate email if provided (email is optional)
      const email = document.getElementById('email');
      if (email.value.trim() && !validateEmail(email.value)) {
        document.getElementById('email-error').style.display = 'block';
        isValid = false;
      }

      // Validate phone
      const phone = document.getElementById('phone');
      if (!validatePhone(phone.value)) {
        document.getElementById('phone-error').style.display = 'block';
        isValid = false;
      }

      // Validate address (from Slide 5)
      const address = document.getElementById('address');
      if (!address.value.trim()) {
        document.getElementById('address-error').style.display = 'block';
        isValid = false;
      }

      if (isValid) submitForm();
    }

    async function submitForm() {
      const formData = {
        zipcode: document.getElementById('zipcode').value,
        damage_type: document.getElementById('damage').value,
        insurance: document.getElementById('insurance').value,
        timeline: document.getElementById('timeline').value,
        address: document.getElementById('address').value.trim(),
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim()
      };

      try {
        const response = await fetch('https://services.leadconnectorhq.com/hooks/p5ZKXWEUephwwTsEQZgU/webhook-trigger/26f20994-5d5d-4b11-8613-9f23ec96c4a1', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) throw new Error('Network response was not ok');
        
        // Replace form content with Thank You message
        document.getElementById('step2').innerHTML = `
          <h2>Thank You!</h2>
          <p style="font-size:1.2em;">We're matching you with 3-5 certified roofers. Expect quotes within 15 minutes!</p>
          <div style="margin:30px 0;">
              <img src="https://cdn-icons-png.flaticon.com/512/3062/3062634.png" style="width:120px;">
          </div>
          <p>Need immediate help? Call or Text <strong>480-613-9666</strong></p>
        `;
        
        // Fire conversion tracking event
        gtag('event', 'conversion', {
          'send_to': 'AW-11337578068/TY61CJPqpJ4aENTslp4q',
          'value': 1.0,
          'currency': 'USD'
        });
      } catch (error) {
        console.error('Error:', error);
        alert('There was an error submitting your request. Please try again.');
      }
    }

    // Initialize form validation and Google Maps features
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('input', updateNextButton);
      });
      // Update ZIP code slide on input to trigger city/state lookup
      document.getElementById('zipcode').addEventListener('input', function() {
        updateNextButton();
        geocodeZip();
      });
      initAutocomplete();
    });
  </script>
</body>
</html>
